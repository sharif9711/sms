<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>문자 순차 전송기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <style>
    body {
      font-family: "Noto Sans KR", sans-serif;
      background: #fafafa;
      text-align: center;
      margin: 0;
      padding: 30px;
    }
    .container {
      background: #fff;
      padding: 20px;
      max-width: 650px;
      margin: auto;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    textarea, input {
      width: 90%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin-top: 8px;
      font-size: 14px;
    }
    button {
      background: #00b36b;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 12px;
    }
    button:hover { background: #008a55; }
    #qrcode { margin-top: 20px; }
    .desc { color: #555; font-size: 0.9em; margin-top: 15px; }
    .btn-list {
      margin-top: 20px;
      text-align: left;
      display: inline-block;
      width: 90%;
    }
    .phone-btn {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f0f0f0;
      padding: 10px 15px;
      margin-top: 8px;
      border-radius: 6px;
      font-size: 14px;
    }
    .send {
      background: #00b36b;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 5px 10px;
      cursor: pointer;
    }
    .send:hover { background: #008a55; }
  </style>
</head>
<body>
  <div class="container">
    <h2>📱 문자 순차 전송기</h2>

    <div id="inputArea">
      <p>핸드폰 번호 (한 줄에 하나씩 입력):</p>
      <textarea id="phonelist" rows="5" placeholder="01012345678&#10;01098765432"></textarea>
      <p>문자 내용:</p>
      <textarea id="msglist" rows="3" placeholder="보낼 문자를 입력하세요."></textarea><br>
      <button onclick="makeQR()">📩 스마트폰용 QR코드 만들기</button>
      <div id="qrcode"></div>
      <div class="desc">
        스마트폰으로 QR을 스캔하면 문자 전송 화면으로 이동합니다.<br>
        (PC에서는 전송이 불가합니다)
      </div>
    </div>

    <div id="sendArea" style="display:none;">
      <h3>📞 전송할 번호 목록</h3>
      <div id="btnContainer" class="btn-list"></div>
      <div class="desc">각 번호별로 [보내기] 버튼을 눌러 순서대로 전송하세요.</div>
    </div>
  </div>

  <script>
    // QR코드 생성
    function makeQR() {
      const phones = document.getElementById("phonelist").value.trim();
      const msg = document.getElementById("msglist").value.trim();
      const qrDiv = document.getElementById("qrcode");

      qrDiv.innerHTML = "";

      if (!phones || !msg) {
        alert("번호와 문자 내용을 모두 입력해주세요.");
        return;
      }

      // 줄바꿈 → URL 인코딩
      const encodedPhones = encodeURIComponent(phones);
      const encodedMsg = encodeURIComponent(msg);
      const link = `${location.origin}${location.pathname}?phones=${encodedPhones}&msg=${encodedMsg}&mode=send`;

      new QRCode(qrDiv, {
        text: link,
        width: 180,
        height: 180
      });

      alert("QR코드가 생성되었습니다. 스마트폰으로 스캔하세요!");
    }

    // 스마트폰 화면 감지
    window.onload = function() {
      const params = new URLSearchParams(location.search);
      if (params.get("mode") === "send") {
        document.getElementById("inputArea").style.display = "none";
        document.getElementById("sendArea").style.display = "block";

        const phoneData = decodeURIComponent(params.get("phones") || "");
        const msg = decodeURIComponent(params.get("msg") || "");
        const phones = phoneData.split(/\r?\n/).map(p => p.trim()).filter(p => p !== "");
        const container = document.getElementById("btnContainer");
        container.innerHTML = "";

        phones.forEach((num, i) => {
          const div = document.createElement("div");
          div.className = "phone-btn";
          div.innerHTML = `
            <span>[${i + 1}] ${num}</span>
            <button class="send" onclick="sendSMS('${num}', '${encodeURIComponent(msg)}')">보내기</button>
          `;
          container.appendChild(div);
        });
      }
    }

    // 문자 전송 함수
    function sendSMS(num, msg) {
      const url = `sms:${num}?body=${decodeURIComponent(msg)}`;
      window.location.href = url; // 문자앱 열기
      // 문자앱 닫히면 다시 브라우저 복귀 가능
    }
  </script>
</body>
</html>
